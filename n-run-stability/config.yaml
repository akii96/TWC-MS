# Universal Stress Test Configuration
# ====================================
# This file configures the stress test runner for any LLM serving framework.
# Edit this file to customize your test parameters.

# Framework to use: sglang, vllm, tgi (must have matching plugin in plugins/)
framework: sglang

# Docker configuration
docker:
  image: lmsysorg/sglang:v0.5.8-rocm700-mi30x
  shm_size: 128G
  network: host
  devices:
    - /dev/kfd
    - /dev/dri

# Environment variables to pass to the container
env:
  ROCM_QUICK_REDUCE_QUANTIZATION: INT4
  HSA_NO_SCRATCH_RECLAIM: 1
  SGLANG_USE_AITER: 1
  SAFETENSORS_FAST_GPU: 1
  SGLANG_AITER_MLA_PERSIST: 0

# Server configuration
server:
  port: 30000
  startup_timeout: 600
  model_path: zai-org/GLM-4.7-FP8

# Framework-specific server arguments (passed to server launch command)
server_args:
  tp-size: 8
  mem-fraction-static: 0.8
  tool-call-parser: glm47
  reasoning-parser: glm45

# Timeout configuration (in seconds)
timeouts:
  container: 900
  prompt: 120

# Test configuration
test:
  num_loops: 20
  prompts_per_loop: 10
  success_pattern: "yes"

# Error patterns to detect in container logs
error_patterns:
  - HSA_STATUS_ERROR_EXCEPTION
  - CUDA error
  - OutOfMemoryError
  - RuntimeError
  - Segmentation fault

# Workspace configuration
workspace:
  base_dir: "$HOME"
  mounts:
    - .cache
    - data
